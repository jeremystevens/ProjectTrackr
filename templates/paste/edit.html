{% extends "layout.html" %}

{% block title %}Edit Paste - FlaskBin{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h4 class="mb-0"><i class="fas fa-edit me-2"></i>Edit Paste</h4>
    </div>
    <div class="card-body paste-form">
        <form method="POST" action="{{ url_for('paste.edit', short_id=paste.short_id) }}" class="needs-validation" novalidate>
            {{ form.hidden_tag() }}
            
            <div class="mb-3">
                <label for="title" class="form-label">Title</label>
                <input type="text" class="form-control" id="title" name="title" 
                       value="{{ form.title.data }}" placeholder="Paste title (optional)" maxlength="255">
            </div>
            
            <div class="mb-3">
                <label for="template" class="form-label">Template (optional)</label>
                {{ form.template(class="form-select", id="template-selector") }}
                <small id="templateHelp" class="form-text text-muted">Select a template to use as a starting point</small>
            </div>
            
            <div class="mb-3">
                <label for="content" class="form-label">Content <span class="text-danger">*</span></label>
                <textarea class="form-control" id="content-area" name="content" rows="15" required>{{ form.content.data }}</textarea>
                <div class="invalid-feedback">
                    Please enter some content for your paste.
                </div>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="syntax" class="form-label">Syntax Highlighting</label>
                    <select class="form-select" id="syntax" name="syntax">
                        <option value="text" {% if form.syntax.data == 'text' %}selected{% endif %}>Plain Text</option>
                        <option value="python" {% if form.syntax.data == 'python' %}selected{% endif %}>Python</option>
                        <option value="javascript" {% if form.syntax.data == 'javascript' %}selected{% endif %}>JavaScript</option>
                        <option value="html" {% if form.syntax.data == 'html' %}selected{% endif %}>HTML</option>
                        <option value="css" {% if form.syntax.data == 'css' %}selected{% endif %}>CSS</option>
                        <option value="java" {% if form.syntax.data == 'java' %}selected{% endif %}>Java</option>
                        <option value="c" {% if form.syntax.data == 'c' %}selected{% endif %}>C</option>
                        <option value="cpp" {% if form.syntax.data == 'cpp' %}selected{% endif %}>C++</option>
                        <option value="csharp" {% if form.syntax.data == 'csharp' %}selected{% endif %}>C#</option>
                        <option value="php" {% if form.syntax.data == 'php' %}selected{% endif %}>PHP</option>
                        <option value="ruby" {% if form.syntax.data == 'ruby' %}selected{% endif %}>Ruby</option>
                        <option value="go" {% if form.syntax.data == 'go' %}selected{% endif %}>Go</option>
                        <option value="rust" {% if form.syntax.data == 'rust' %}selected{% endif %}>Rust</option>
                        <option value="swift" {% if form.syntax.data == 'swift' %}selected{% endif %}>Swift</option>
                        <option value="bash" {% if form.syntax.data == 'bash' %}selected{% endif %}>Bash/Shell</option>
                        <option value="sql" {% if form.syntax.data == 'sql' %}selected{% endif %}>SQL</option>
                        <option value="xml" {% if form.syntax.data == 'xml' %}selected{% endif %}>XML</option>
                        <option value="json" {% if form.syntax.data == 'json' %}selected{% endif %}>JSON</option>
                        <option value="markdown" {% if form.syntax.data == 'markdown' %}selected{% endif %}>Markdown</option>
                        <option value="yaml" {% if form.syntax.data == 'yaml' %}selected{% endif %}>YAML</option>
                    </select>
                </div>
                
                <div class="col-md-6">
                    <label for="expiration" class="form-label">Expiration</label>
                    <select class="form-select" id="expiration" name="expiration">
                        <option value="0">Never</option>
                        <option value="1">10 Minutes</option>
                        <option value="2">1 Hour</option>
                        <option value="3">1 Day</option>
                        <option value="4">1 Month</option>
                    </select>
                    <small class="form-text text-muted">
                        {% if paste.expires_at %}
                            Current expiration: {{ paste.expires_at.strftime('%b %d, %Y %H:%M') }}
                        {% else %}
                            Current expiration: Never
                        {% endif %}
                    </small>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="visibility" class="form-label">Visibility</label>
                <select class="form-select" id="visibility" name="visibility">
                    <option value="public" {% if form.visibility.data == 'public' %}selected{% endif %}>Public (Visible to everyone, listed in archive)</option>
                    <option value="unlisted" {% if form.visibility.data == 'unlisted' %}selected{% endif %}>Unlisted (Visible to anyone with the link, not listed)</option>
                    <option value="private" {% if form.visibility.data == 'private' %}selected{% endif %}>Private (Only visible to you)</option>
                </select>
            </div>
            
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="comments_enabled" name="comments_enabled" 
                       {% if form.comments_enabled.data %}checked{% endif %}>
                <label class="form-check-label" for="comments_enabled">Enable comments</label>
            </div>
            
            <div class="mb-3">
                <label for="edit_description" class="form-label">Edit Description</label>
                <input type="text" class="form-control" id="edit_description" name="edit_description" 
                       placeholder="Short description of your changes (optional)" maxlength="255">
                <small class="form-text text-muted">
                    This will be shown in the revision history to help understand the changes you made.
                </small>
            </div>
            
            <div id="syntax-preview" class="syntax-preview mb-3">
                <div class="text-muted">Enter some code to see syntax highlighting preview</div>
            </div>
            
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Update Paste
                </button>
                <a href="{{ url_for('paste.view', short_id=paste.short_id) }}" class="btn btn-outline-secondary">
                    <i class="fas fa-times me-2"></i>Cancel
                </a>
                {% if current_user.is_authenticated and current_user.id == paste.user_id %}
                <a href="{{ url_for('paste.revisions', short_id=paste.short_id) }}" class="btn btn-outline-secondary ms-auto">
                    <i class="fas fa-history me-2"></i>View Revision History
                </a>
                {% endif %}
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener("DOMContentLoaded", function() {
  // Select elements
  const templateSelector = document.getElementById("template-selector");
  const contentArea = document.getElementById("content-area");
  const syntaxSelector = document.getElementById("syntax");
  const helpText = document.getElementById("templateHelp");
  
  // Add event listener to template selector
  templateSelector.addEventListener("change", function() {
    const templateId = parseInt(this.value);
    
    if (templateId <= 0) {
      helpText.textContent = "Select a template to use as a starting point";
      return;
    }
    
    // In edit mode, always confirm before replacing content
    if (confirm("Replace your current content with this template? Your existing content will be lost.")) {
      // Load template data via AJAX
      fetch("/template/" + templateId)
        .then(response => response.json())
        .then(data => {
          // Update help text
          helpText.innerHTML = "<i class=\"fas fa-info-circle me-1\"></i> " + data.description;
          
          contentArea.value = data.content;
          syntaxSelector.value = data.syntax;
          updateSyntaxPreview();
        })
        .catch(error => {
          console.error("Error loading template:", error);
          helpText.innerHTML = "<span class=\"text-danger\">Error loading template</span>";
        });
    }
  });
  
  // Syntax preview functionality
  function updateSyntaxPreview() {
  function updateSyntaxPreview() {
    const content = contentArea.value;
    const content = contentArea.value;
    const syntax = syntaxSelector.value;
    const syntax = syntaxSelector.value;
    const previewContainer = document.getElementById("syntax-preview");
    const previewContainer = document.getElementById("syntax-preview");
    
    
    if (content.trim() === "") {
    if (content.trim() === "") {
      previewContainer.innerHTML = '<div class="text-muted">Enter some code to see syntax highlighting preview</div>';
      previewContainer.innerHTML = '<div class="text-muted">Enter some code to see syntax highlighting preview</div>';
      return;
      return;
    }
    }
    
    
    previewContainer.innerHTML = "<div class=\"alert alert-info\">" +
    previewContainer.innerHTML = "<div class=\"alert alert-info\">" +
      "<i class=\"fas fa-info-circle me-2\"></i>" +
      "<i class=\"fas fa-info-circle me-2\"></i>" +
      "A preview would be shown here with " + syntax + " syntax highlighting." +
      "A preview would be shown here with " + syntax + " syntax highlighting." +
    "</div>";
    "</div>";
  }
  }
  
  
  // Set up syntax preview events
  // Set up syntax preview events
  contentArea.addEventListener("input", updateSyntaxPreview);
  contentArea.addEventListener("input", updateSyntaxPreview);
  syntaxSelector.addEventListener("change", updateSyntaxPreview);
  syntaxSelector.addEventListener("change", updateSyntaxPreview);
  
  
  // Initial syntax preview update
  // Initial syntax preview update
  updateSyntaxPreview();
  updateSyntaxPreview();
});
});
</script>
</script>
{% endblock %}
{% endblock %}
